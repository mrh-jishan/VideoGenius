{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the VideoGenius application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "displayName": {
          "type": "string",
          "description": "User's display name."
        },
        "geminiApiKey": {
          "type": "string",
          "description": "User's Gemini API key."
        }
      },
      "required": [
        "id",
        "email",
        "displayName",
        "geminiApiKey"
      ]
    },
    "Project": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Project",
      "type": "object",
      "description": "Represents a video generation project.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Project entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Project)"
        },
        "name": {
          "type": "string",
          "description": "Name of the project."
        },
        "prompt": {
          "type": "string",
          "description": "The initial text prompt for video generation."
        },
        "creationDate": {
          "type": "string",
          "description": "The date and time when the project was created.",
          "format": "date-time"
        },
        "lastModified": {
          "type": "string",
          "description": "The date and time when the project was last modified.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "name",
        "prompt",
        "creationDate",
        "lastModified"
      ]
    },
    "Scene": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Scene",
      "type": "object",
      "description": "Represents a single scene within a video project.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Scene entity."
        },
        "projectId": {
          "type": "string",
          "description": "Reference to Project. (Relationship: Project 1:N Scene)"
        },
        "title": {
          "type": "string",
          "description": "Title of the scene."
        },
        "narration": {
          "type": "string",
          "description": "Narration text for the scene."
        },
        "visualPrompt": {
          "type": "string",
          "description": "Prompt for generating visuals for the scene."
        },
        "duration": {
          "type": "number",
          "description": "Duration of the scene in seconds."
        },
        "musicMoodKeywords": {
          "type": "string",
          "description": "Keywords for background music mood."
        },
        "sfxKeywords": {
          "type": "string",
          "description": "Keywords for scene-specific sound effects."
        },
        "imageId": {
          "type": "string",
          "description": "Reference to ImageAsset. (Relationship: ImageAsset 1:1 Scene)"
        }
      },
      "required": [
        "id",
        "projectId",
        "title",
        "narration",
        "visualPrompt",
        "duration",
        "musicMoodKeywords",
        "sfxKeywords",
        "imageId"
      ]
    },
    "ImageAsset": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ImageAsset",
      "type": "object",
      "description": "Represents an image asset used in a scene.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the ImageAsset entity."
        },
        "url": {
          "type": "string",
          "description": "URL of the image asset."
        },
        "source": {
          "type": "string",
          "description": "Source of the image asset (e.g., 'Pixabay', 'AI Generated')."
        }
      },
      "required": [
        "id",
        "url",
        "source"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user data. User ID is used as the document ID.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/projects/{projectId}",
        "definition": {
          "entityName": "Project",
          "schema": {
            "$ref": "#/backend/entities/Project"
          },
          "description": "Stores video generation projects for a specific user. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "projectId",
              "description": "The unique identifier for the project."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/projects/{projectId}/scenes/{sceneId}",
        "definition": {
          "entityName": "Scene",
          "schema": {
            "$ref": "#/backend/entities/Scene"
          },
          "description": "Stores scenes for a specific video generation project. Includes denormalized 'userId' and 'projectId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "projectId",
              "description": "The unique identifier for the project."
            },
            {
              "name": "sceneId",
              "description": "The unique identifier for the scene."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/imageAssets/{imageAssetId}",
        "definition": {
          "entityName": "ImageAsset",
          "schema": {
            "$ref": "#/backend/entities/ImageAsset"
          },
          "description": "Stores image assets for a specific user. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "imageAssetId",
              "description": "The unique identifier for the image asset."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure security, scalability, and ease of debugging, adhering to the principles of Authorization Independence, Clarity of Intent, DBAC, and QAPs. It uses Structural Segregation and Access Modeling to achieve these goals.\n\n- **Authorization Independence:** The structure avoids hierarchical authorization dependencies by denormalizing user ownership. Projects, scenes, and image assets are located under the user's document or further nested, eliminating the need for `get()` calls in security rules to verify ownership.\n\n- **Clarity of Intent:** The path structure clearly expresses the relationships between entities. The path `/users/{userId}/projects/{projectId}` explicitly shows that a project belongs to a user.\n\n- **DBAC:** User roles are not stored in custom claims but are derived directly from the `request.auth.uid`, simplifying the security rules.\n\n- **QAPs:** The segregation of data based on user ownership allows for secure list operations. Rules can easily check if the requesting user ID matches the owner ID in the path.\n\n**Denormalization Strategy:** The `projects` and other subcollections are located directly under the `users` collection, denormalizing the user-project relationship into the document path. This eliminates the need to fetch parent document properties to determine access, enabling atomic operations.\n\n**Structural Segregation:** Each collection serves a specific purpose and has a homogeneous security posture. User data is separated from project data, and access is controlled based on the user's authentication status and ownership.\n\n**Access Modeling:**\n\n- **Private Data:** User-specific data (projects, scenes, image assets) is stored under the `/users/{userId}` path, indicating private ownership.\n\n- **Path-Based Ownership:** The paths `/users/{userId}/projects/{projectId}`, `/users/{userId}/projects/{projectId}/scenes/{sceneId}`, and `/users/{userId}/imageAssets/{imageAssetId}` clearly define ownership and enable simple security rules.\n\nThis design facilitates simple, robust, and easily debuggable security rules by ensuring authorization independence and adhering to the core design principles."
  }
}